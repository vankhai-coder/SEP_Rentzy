@startuml Owner Confirm Handover Use Case Class Diagram

title Owner Confirm Handover Use Case Class Diagram

' Route Layer
class HandoverRoute {
  +POST /api/booking/:bookingId/confirm-owner-handover
  +middleware: uploadMiddleware
  +middleware: verifyJWTToken
  +handler: confirmOwnerHandover()
}

' Middleware
class uploadMiddleware {
  +storage: multer.memoryStorage()
  +limits: 10MB fileSize
  +fileFilter: images only
  +array("images", 10)
}

class verifyJWTToken {
  +verify(token)
  +extractUserId()
}

' Controller Layer
class HandoverController {
  +confirmOwnerHandover(req, res)
  -validateBooking()
  -validateImageCount()
  -uploadToCloudinary()
  -updateHandoverRecord()
}

' Model Layer
class Booking {
  +booking_id: string
  +vehicle_id: string
  +renter_id: string
  +status: string
  +total_amount: number
  +findOne()
  +include: Vehicle
}

class BookingHandover {
  +handover_id: string
  +booking_id: string
  +pre_rental_images: array
  +owner_handover_confirmed: boolean
  +handover_time: datetime
  +findOne()
  +create()
  +update()
}

class Vehicle {
  +vehicle_id: string
  +owner_id: string
  +name: string
  +model: string
}

class User {
  +user_id: string
  +username: string
  +email: string
}

' External Service
class CloudinaryService {
  +upload_stream()
  +folder: "handover/pre-rental/{bookingId}"
  +resource_type: "image"
  +secure_url: string
}

' Relationships
HandoverRoute --> uploadMiddleware : uses
HandoverRoute --> verifyJWTToken : uses
HandoverRoute --> HandoverController : calls

uploadMiddleware --> HandoverController : processes files

verifyJWTToken --> HandoverController : provides userId

HandoverController --> Booking : validates
HandoverController --> BookingHandover : creates/updates
HandoverController --> CloudinaryService : uploads images

Booking --> Vehicle : includes
Booking --> User : belongs to owner

BookingHandover --> Booking : belongs to

' Notes
note right of HandoverController
  Validation Rules:
  - Booking must belong to owner
  - Booking status must be "fully_paid"
  - Minimum 5 images required
  - Maximum 10 images allowed
  - Images uploaded to Cloudinary
  - Sets owner_handover_confirmed = true
end note

note right of CloudinaryService
  Upload Configuration:
  - Folder: handover/pre-rental/{bookingId}
  - Resource type: image
  - Returns secure_url for each image
end note

@enduml